[
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "30m",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,8,13,18,23,28,33,38,43,48,53,58 * * * *",
"description": "One or more of your indexers is reporting an abnormal state.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Abnormal State of Indexer Processor",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_indexer /services/server/introspection/indexer \n  | fields splunk_server, average_KBps, status, reason \n  | where status != \"normal\" \n  | eval average_KBps = round(average_KBps, 0) \n  | eval status= if(status==\"normal\", status, status.\" - \".reason) \n  | fields - reason \n  | rename splunk_server as Instance, average_KBps as \"Average KB/s (last 30s)\", status as Status",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "30m",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,8,13,18,23,28,33,38,43,48,53,58 * * * *",
"description": "One or more instances has exceeded 90% memory usage.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Critical System Physical Memory Usage",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_* /services/server/status/resource-usage/hostwide \n  | eval percentage=round(mem_used/mem,3)*100 \n  | where percentage > 90 \n  | fields splunk_server, percentage, mem_used, mem \n  | rename splunk_server AS Instance, mem AS \"Physical memory installed (MB)\", percentage AS \"Memory used (%)\", mem_used AS \"Memory used (MB)\"",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "0",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3 0 * * *",
"description": "You have instances with licenses that expired or will expire within 2 weeks. No other valid licenses are installed.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Expired and Soon To Expire Licenses",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_license_master /services/licenser/licenses \n  | join type=outer group_id splunk_server [ \n    rest splunk_server_group=dmc_group_license_master /services/licenser/groups \n    | where is_active = 1 \n    | rename title AS group_id \n    | fields is_active group_id splunk_server] \n  | where is_active = 1 \n  | eval days_left = floor((expiration_time - now()) / 86400) \n  | where NOT (quota = 1048576 OR label == \"Splunk Enterprise Reset Warnings\" OR label == \"Splunk Lite Reset Warnings\") \n  | eventstats max(eval(if(days_left >= 14, 1, 0))) as has_valid_license by splunk_server \n  | where has_valid_license == 0 AND (status == \"EXPIRED\" OR days_left < 15) \n  | eval expiration_status = case(days_left >= 14, days_left.\" days left\", days_left < 14 AND days_left >= 0, \"Expires soon: \".days_left.\" days left\", days_left < 0, \"Expired\") \n  | eval total_gb=round(quota/1024/1024/1024,3) \n  | fields splunk_server label license_hash type group_id total_gb expiration_time expiration_status \n  | convert ctime(expiration_time) \n  | rename splunk_server AS Instance label AS \"Label\" license_hash AS \"License Hash\" type AS Type group_id AS Group total_gb AS Size expiration_time AS \"Expires On\" expiration_status AS Status",
"sharing": "app"
},
{
"alert.suppress": "0",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"auto_summarize.dispatch.earliest_time": "-1d@h",
"cron_schedule": "*/15 * * * *",
"description": "One or more forwarders are missing.",
"disabled": "1",
"is_scheduled": "1",
"name": "DMC Alert - Missing forwarders",
"owner": "nobody",
"search": "| inputlookup dmc_forwarder_assets \n  | search status=\"missing\" \n  | rename hostname as Instance",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "4h",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,33 * * * *",
"description": "You have used 80% of your disk capacity.",
"disabled": "1",
"is_scheduled": "1",
"name": "DMC Alert - Near Critical Disk Usage",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_* /services/server/status/partitions-space \n  | eval free = if(isnotnull(available), available, free) \n  | eval usage = capacity - free \n  | eval pct_usage = floor(usage / capacity * 100) \n  | where pct_usage > 80 \n  | stats first(fs_type) as fs_type first(capacity) AS capacity first(usage) AS usage first(pct_usage) AS pct_usage by splunk_server, mount_point \n  | eval usage = round(usage / 1024, 2) \n  | eval capacity = round(capacity / 1024, 2) \n  | rename splunk_server AS Instance mount_point as \"Mount Point\", fs_type as \"File System Type\", usage as \"Usage (GB)\", capacity as \"Capacity (GB)\", pct_usage as \"Usage (%)\"",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "1h",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,13,23,33,43,53 * * * *",
"description": "One or more of your indexer queues is reporting a fill percentage, averaged over the last 15 minutes, of 90% or more.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Saturated Event-Processing Queues",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_indexer /services/server/introspection/queues \n  | search title=tcpin_queue OR title=parsingQueue OR title=aggQueue OR title=typingQueue OR title=indexQueue \n  | eval fifteen_min_fill_perc = round(value_cntr3_size_bytes_lookback / max_size_bytes * 100,2) \n  | fields title fifteen_min_fill_perc splunk_server \n  | where fifteen_min_fill_perc > 90 \n  | rename splunk_server as Instance, title AS \"Queue name\", fifteen_min_fill_perc AS \"Average queue fill percentage (last 15min)\"",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "30m",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,8,13,18,23,28,33,38,43,48,53,58 * * * *",
"description": "One or more of your search peers is currently down.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Search Peer Not Responding",
"owner": "nobody",
"search": "| rest splunk_server=local /services/search/distributed/peers/ \n  | where status!=\"Up\" AND disabled=0 \n  | fields peerName, status \n  | rename peerName as Instance, status as Status",
"sharing": "app"
},
{
"action.email.inline": "1",
"action.email.sendresults": "1",
"alert.expires": "7d",
"alert.suppress": "1",
"alert.suppress.period": "4h",
"alert.track": "1",
"alert_comparator": "greater than",
"alert_threshold": "0",
"alert_type": "number of events",
"cron_schedule": "3,33 * * * *",
"description": "You have used 90% of your total daily license quota.",
"disabled": "1",
"dispatch.ttl": "14400",
"is_scheduled": "1",
"name": "DMC Alert - Total License Usage Near Daily Quota",
"owner": "nobody",
"search": "| rest splunk_server_group=dmc_group_license_master /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | mvexpand stack_id \n  | join type=outer stack_id splunk_server [rest splunk_server_group=dmc_group_license_master /services/licenser/pools] \n  | fields splunk_server,stack_id,effective_quota,used_bytes \n  | stats sum(used_bytes) as used_bytes max(effective_quota) as stack_quota by stack_id \n  | eval usedGB=round(used_bytes/1024/1024/1024,3) \n  | eval totalGB=round(stack_quota/1024/1024/1024,3) \n  | eval percentage=round(usedGB / totalGB, 3)*100 \n  | fields stack_id, percentage, usedGB, totalGB \n  | where percentage > 90 \n  | rename stack_id AS Instance, percentage AS \"License quota used (%)\", usedGB AS \"License quota used (GB)\", totalGB as \"Total license quota (GB)\"",
"sharing": "app"
},
{
"alert.track": "0",
"alert_type": "always",
"dispatchAs": "user",
"is_scheduled": "0",
"name": "DMC Asset - Build Full",
"owner": "nobody",
"search": "| rest splunk_server=local /services/search/distributed/peers \n  | search status=Up disabled=0 \n  | eval os = os_name \n  | fields guid title peerName host host_fqdn server_roles search_groups cpu_arch os numberOfCores physicalMemoryMB version \n  | rename title AS peerURI peerName AS serverName host_fqdn AS machine numberOfCores AS cpu_count physicalMemoryMB AS mem version AS splunk_version server_roles AS inherited_server_roles \n  | where isnotnull(mvfind(search_groups,\"dmc_group_\")) \n  | join type=outer peerURI [ \n    | rest splunk_server=local /servicesNS/nobody/splunk_monitoring_console/configs/conf-splunk_monitoring_console_assets \n    | fields title host host_fqdn \n    | rename title AS peerURI host_fqdn AS machine] \n  | mvexpand search_groups \n  | append [ | `dmc_get_local_instance_asset_in_distributed_mode` ] \n  | fields peerURI serverName host machine search_groups \n  | rename search_groups AS search_group \n  | outputlookup dmc_assets",
"sharing": "app"
},
{
"alert.track": "0",
"alert_type": "always",
"cron_schedule": "*/1 * * * *",
"description": "This search establishes an updated cache of metadata necessary for the localhost to be included in DMC dashboards. This search will be disabled when user go throught the setup process. and will be re-enabled when user resets to factory mode.",
"dispatchAs": "user",
"is_scheduled": "1",
"name": "DMC Asset - Build Standalone Asset Table",
"owner": "nobody",
"run_n_times": "1",
"run_on_startup": "1",
"search": "| `dmc_get_local_instance_asset` \n  | rename search_groups AS search_group \n  | inputlookup append=true dmc_assets \n  | stats last(*) AS * by peerURI, search_group \n  | fields peerURI serverName host machine search_group \n  | outputlookup dmc_assets",
"sharing": "app"
},
{
"alert.track": "0",
"alert_type": "always",
"dispatchAs": "user",
"is_scheduled": "0",
"name": "DMC Asset - Build Standalone Computed Groups Only",
"owner": "nobody",
"search": "| `dmc_get_local_instance_asset` \n  | rename search_groups AS search_group \n  | fields peerURI serverName host machine search_group \n  | outputlookup dmc_assets",
"sharing": "app"
},
{
"alert.track": "0",
"alert_type": "always",
"cron_schedule": "3,18,33,48 * * * *",
"disabled": "1",
"dispatch.earliest_time": "-16m@m",
"dispatch.latest_time": "-1m@m",
"dispatchAs": "user",
"is_scheduled": "1",
"name": "DMC Forwarder - Build Asset Table",
"owner": "nobody",
"search": "`dmc_build_forwarder_assets(1m)` \n  | inputlookup append=true dmc_forwarder_assets \n  | stats values(forwarder_type) as forwarder_type, latest(version) as version, values(arch) as arch, values(os) as os, max(last_connected) as last_connected, latest(_time) as _time, values(new_sum_kb) as sum_kb, values(new_avg_tcp_kbps_sparkline) as avg_tcp_kbps_sparkline, values(new_avg_tcp_kbps) as avg_tcp_kbps, values(new_avg_tcp_eps) as avg_tcp_eps by guid, hostname \n  | addinfo \n  | eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), \"missing\", \"active\") \n  | eval sum_kb = round(sum_kb, 2) \n  | eval avg_tcp_kbps = round(avg_tcp_kbps, 2) \n  | eval avg_tcp_eps = round(avg_tcp_eps, 2) \n  | fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps \n  | outputlookup dmc_forwarder_assets",
"sharing": "app"
},
{
"alert.track": "0",
"alert_type": "always",
"auto_summarize.cron_schedule": "3,13,23,33,43,53 * * * *",
"auto_summarize.dispatch.earliest_time": "-1mon@d",
"dispatch.earliest_time": "-31d",
"dispatch.latest_time": "-0d",
"is_scheduled": "0",
"name": "DMC License Usage Data Cube",
"owner": "nobody",
"search": "index=_internal source=*license_usage.log* type=\"Usage\" | eval h=if(len(h)=0 OR isnull(h),\"(SQUASHED)\",h) | eval s=if(len(s)=0 OR isnull(s),\"(SQUASHED)\",s) | eval idx=if(len(idx)=0 OR isnull(idx),\"(UNKNOWN)\",idx) | bin _time span=1d | stats sum(b) as b by _time, host, pool, s, st, h, idx",
"sharing": "app"
}
]
